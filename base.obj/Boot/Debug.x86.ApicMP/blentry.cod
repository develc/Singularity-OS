; Listing generated by Microsoft (R) Optimizing Compiler Version 14.00.50727.762 

	TITLE	C:\Users\cc\source\repos\Singularity-OS\base\Boot\SingLdrPc\blentry.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?BlStartTime@@3U_BL_TIME@@A			; BlStartTime
PUBLIC	?BlBootStackLimit@@3PAXA			; BlBootStackLimit
PUBLIC	?BlBootStackBase@@3PAXA				; BlBootStackBase
_BSS	SEGMENT
?BlStartTime@@3U_BL_TIME@@A DB 0cH DUP (?)		; BlStartTime
?BlBootStackLimit@@3PAXA DD 01H DUP (?)			; BlBootStackLimit
?BlBootStackBase@@3PAXA DD 01H DUP (?)			; BlBootStackBase
_BSS	ENDS
PUBLIC	??_C@_0M@OKIOIALF@blentry?4cpp?$AA@		; `string'
PUBLIC	?BlApEntry@@YIXXZ				; BlApEntry
EXTRN	?BlRtlHaltInternal@@YIXPBDK@Z:PROC		; BlRtlHaltInternal
EXTRN	?BlSingularityApEntry@@YIXXZ:PROC		; BlSingularityApEntry
;	COMDAT ??_C@_0M@OKIOIALF@blentry?4cpp?$AA@
; File c:\users\cc\source\repos\singularity-os\base\boot\singldrpc\blentry.cpp
CONST	SEGMENT
??_C@_0M@OKIOIALF@blentry?4cpp?$AA@ DB 'blentry.cpp', 00H ; `string'
; Function compile flags: /Odsp
CONST	ENDS
;	COMDAT ?BlApEntry@@YIXXZ
_TEXT	SEGMENT
?BlApEntry@@YIXXZ PROC					; BlApEntry, COMDAT

; 37   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 38   :     BlSingularityApEntry();

  00003	e8 00 00 00 00	 call	 ?BlSingularityApEntry@@YIXXZ ; BlSingularityApEntry

; 39   : 
; 40   :     BlRtlHalt();

  00008	6a 28		 push	 40			; 00000028H
  0000a	5a		 pop	 edx
  0000b	b9 00 00 00 00	 mov	 ecx, OFFSET ??_C@_0M@OKIOIALF@blentry?4cpp?$AA@
  00010	e8 00 00 00 00	 call	 ?BlRtlHaltInternal@@YIXPBDK@Z ; BlRtlHaltInternal

; 41   : }

  00015	5d		 pop	 ebp
  00016	c3		 ret	 0
?BlApEntry@@YIXXZ ENDP					; BlApEntry
_TEXT	ENDS
PUBLIC	??_C@_11LOCGONAA@?$AA?$AA@			; `string'
PUBLIC	??_C@_0BB@HJLOGHGL@unknown?5source?$CB?6?$AA@	; `string'
PUBLIC	??_C@_07HCENNHAB@Flash?4?6?$AA@			; `string'
PUBLIC	??_C@_09JKNBOLCM@network?4?6?$AA@		; `string'
PUBLIC	??_C@_0BJ@OHCMCPKN@FAT32?5on?5drive?50x?$CF02x?4?6?6?$AA@ ; `string'
PUBLIC	??_C@_0BJ@NLIFOCJG@FAT16?5on?5drive?50x?$CF02x?4?6?6?$AA@ ; `string'
PUBLIC	??_C@_0BG@HNCLEJLF@CD?5in?5drive?50x?$CF02x?4?6?6?$AA@ ; `string'
PUBLIC	??_C@_0O@PEJMEJNJ@Booting?5from?5?$AA@		; `string'
PUBLIC	?BlGetBeb@@YIPAU_BEB@@XZ			; BlGetBeb
PUBLIC	?BlInitialize@@YIXXZ				; BlInitialize
EXTRN	?BlSingularityInitialize@@YIXKPAU_FAR_POINTER@@0@Z:PROC ; BlSingularityInitialize
EXTRN	?BlCommandLine@@3PA_WA:DWORD			; BlCommandLine
EXTRN	?BlAcpiNumberOfProcessors@@3KA:DWORD		; BlAcpiNumberOfProcessors
EXTRN	?BlAcpiInitialize@@YIXXZ:PROC			; BlAcpiInitialize
EXTRN	?BlMpsInitialize@@YIXXZ:PROC			; BlMpsInitialize
EXTRN	?BlPnpInitialize@@YIXXZ:PROC			; BlPnpInitialize
EXTRN	?BlFlashInitialize@@YIXPAX0@Z:PROC		; BlFlashInitialize
EXTRN	?BlPxeInitialize@@YIXXZ:PROC			; BlPxeInitialize
EXTRN	?BlFatInitialize@@YIXEE@Z:PROC			; BlFatInitialize
EXTRN	?BlCdInitialize@@YIXE@Z:PROC			; BlCdInitialize
EXTRN	?BlRtlPrintf@@YAEPBDZZ:PROC			; BlRtlPrintf
;	COMDAT ??_C@_11LOCGONAA@?$AA?$AA@
CONST	SEGMENT
??_C@_11LOCGONAA@?$AA?$AA@ DB 00H, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BB@HJLOGHGL@unknown?5source?$CB?6?$AA@
CONST	SEGMENT
??_C@_0BB@HJLOGHGL@unknown?5source?$CB?6?$AA@ DB 'unknown source!', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_07HCENNHAB@Flash?4?6?$AA@
CONST	SEGMENT
??_C@_07HCENNHAB@Flash?4?6?$AA@ DB 'Flash.', 0aH, 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_09JKNBOLCM@network?4?6?$AA@
CONST	SEGMENT
??_C@_09JKNBOLCM@network?4?6?$AA@ DB 'network.', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@OHCMCPKN@FAT32?5on?5drive?50x?$CF02x?4?6?6?$AA@
CONST	SEGMENT
??_C@_0BJ@OHCMCPKN@FAT32?5on?5drive?50x?$CF02x?4?6?6?$AA@ DB 'FAT32 on dr'
	DB	'ive 0x%02x.', 0aH, 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@NLIFOCJG@FAT16?5on?5drive?50x?$CF02x?4?6?6?$AA@
CONST	SEGMENT
??_C@_0BJ@NLIFOCJG@FAT16?5on?5drive?50x?$CF02x?4?6?6?$AA@ DB 'FAT16 on dr'
	DB	'ive 0x%02x.', 0aH, 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@HNCLEJLF@CD?5in?5drive?50x?$CF02x?4?6?6?$AA@
CONST	SEGMENT
??_C@_0BG@HNCLEJLF@CD?5in?5drive?50x?$CF02x?4?6?6?$AA@ DB 'CD in drive 0x'
	DB	'%02x.', 0aH, 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0O@PEJMEJNJ@Booting?5from?5?$AA@
CONST	SEGMENT
??_C@_0O@PEJMEJNJ@Booting?5from?5?$AA@ DB 'Booting from ', 00H ; `string'
; Function compile flags: /Odsp
CONST	ENDS
;	COMDAT ?BlInitialize@@YIXXZ
_TEXT	SEGMENT
tv65 = -8						; size = 4
_Beb$ = -4						; size = 4
?BlInitialize@@YIXXZ PROC				; BlInitialize, COMDAT

; 56   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	51		 push	 ecx

; 57   :     PBEB Beb;
; 58   : 
; 59   :     Beb = BlGetBeb();

  00005	e8 00 00 00 00	 call	 ?BlGetBeb@@YIPAU_BEB@@XZ ; BlGetBeb
  0000a	89 45 fc	 mov	 DWORD PTR _Beb$[ebp], eax

; 60   : 
; 61   :     //
; 62   :     // Check boot type and perform any necessary source specific initialization.
; 63   :     //
; 64   : 
; 65   :     BlRtlPrintf("Booting from ");

  0000d	68 00 00 00 00	 push	 OFFSET ??_C@_0O@PEJMEJNJ@Booting?5from?5?$AA@
  00012	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  00017	59		 pop	 ecx

; 66   : 
; 67   :     switch (Beb->BootType) {

  00018	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  0001b	8b 00		 mov	 eax, DWORD PTR [eax]
  0001d	89 45 f8	 mov	 DWORD PTR tv65[ebp], eax
  00020	83 7d f8 01	 cmp	 DWORD PTR tv65[ebp], 1
  00024	74 1d		 je	 SHORT $LN10@BlInitiali
  00026	83 7d f8 02	 cmp	 DWORD PTR tv65[ebp], 2
  0002a	74 39		 je	 SHORT $LN9@BlInitiali
  0002c	83 7d f8 03	 cmp	 DWORD PTR tv65[ebp], 3
  00030	74 54		 je	 SHORT $LN8@BlInitiali
  00032	83 7d f8 04	 cmp	 DWORD PTR tv65[ebp], 4
  00036	74 6f		 je	 SHORT $LN7@BlInitiali
  00038	83 7d f8 05	 cmp	 DWORD PTR tv65[ebp], 5
  0003c	74 7b		 je	 SHORT $LN6@BlInitiali
  0003e	e9 94 00 00 00	 jmp	 $LN5@BlInitiali
$LN10@BlInitiali:

; 68   : 
; 69   :         case BL_CD_BOOT: {
; 70   : 
; 71   :             BlRtlPrintf("CD in drive 0x%02x.\n\n", Beb->BootDriveNumber);

  00043	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  00046	ff 70 04	 push	 DWORD PTR [eax+4]
  00049	68 00 00 00 00	 push	 OFFSET ??_C@_0BG@HNCLEJLF@CD?5in?5drive?50x?$CF02x?4?6?6?$AA@
  0004e	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  00053	59		 pop	 ecx
  00054	59		 pop	 ecx

; 72   : 
; 73   :             BlCdInitialize((UINT8) Beb->BootDriveNumber);

  00055	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  00058	8a 48 04	 mov	 cl, BYTE PTR [eax+4]
  0005b	e8 00 00 00 00	 call	 ?BlCdInitialize@@YIXE@Z	; BlCdInitialize

; 74   : 
; 75   :             break;

  00060	e9 8a 00 00 00	 jmp	 $LN11@BlInitiali
$LN9@BlInitiali:

; 76   :         }
; 77   : 
; 78   :         case BL_FAT16_BOOT: {
; 79   : 
; 80   :             BlRtlPrintf("FAT16 on drive 0x%02x.\n\n", Beb->BootDriveNumber);

  00065	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  00068	ff 70 04	 push	 DWORD PTR [eax+4]
  0006b	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@NLIFOCJG@FAT16?5on?5drive?50x?$CF02x?4?6?6?$AA@
  00070	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  00075	59		 pop	 ecx
  00076	59		 pop	 ecx

; 81   : 
; 82   :             BlFatInitialize((UINT8) Beb->BootDriveNumber, MBR_FAT16LBA);

  00077	b2 0e		 mov	 dl, 14			; 0000000eH
  00079	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  0007c	8a 48 04	 mov	 cl, BYTE PTR [eax+4]
  0007f	e8 00 00 00 00	 call	 ?BlFatInitialize@@YIXEE@Z ; BlFatInitialize

; 83   : 
; 84   :             break;

  00084	eb 69		 jmp	 SHORT $LN11@BlInitiali
$LN8@BlInitiali:

; 85   :         }
; 86   : 
; 87   :         case BL_FAT32_BOOT: {
; 88   : 
; 89   :             BlRtlPrintf("FAT32 on drive 0x%02x.\n\n", Beb->BootDriveNumber);

  00086	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  00089	ff 70 04	 push	 DWORD PTR [eax+4]
  0008c	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@OHCMCPKN@FAT32?5on?5drive?50x?$CF02x?4?6?6?$AA@
  00091	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  00096	59		 pop	 ecx
  00097	59		 pop	 ecx

; 90   : 
; 91   :             BlFatInitialize((UINT8) Beb->BootDriveNumber, MBR_FAT32LBA);

  00098	b2 0c		 mov	 dl, 12			; 0000000cH
  0009a	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  0009d	8a 48 04	 mov	 cl, BYTE PTR [eax+4]
  000a0	e8 00 00 00 00	 call	 ?BlFatInitialize@@YIXEE@Z ; BlFatInitialize

; 92   : 
; 93   :             break;

  000a5	eb 48		 jmp	 SHORT $LN11@BlInitiali
$LN7@BlInitiali:

; 94   :         }
; 95   : 
; 96   :         case BL_PXE_BOOT: {
; 97   : 
; 98   :             BlRtlPrintf("network.\n");

  000a7	68 00 00 00 00	 push	 OFFSET ??_C@_09JKNBOLCM@network?4?6?$AA@
  000ac	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  000b1	59		 pop	 ecx

; 99   : 
; 100  :             BlPxeInitialize();

  000b2	e8 00 00 00 00	 call	 ?BlPxeInitialize@@YIXXZ	; BlPxeInitialize

; 101  : 
; 102  :             break;

  000b7	eb 36		 jmp	 SHORT $LN11@BlInitiali
$LN6@BlInitiali:

; 103  :         }
; 104  : 
; 105  :         case BL_FLASH_BOOT: {
; 106  : 
; 107  :             BlRtlPrintf("Flash.\n");

  000b9	68 00 00 00 00	 push	 OFFSET ??_C@_07HCENNHAB@Flash?4?6?$AA@
  000be	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  000c3	59		 pop	 ecx

; 108  : 
; 109  :             BlFlashInitialize((PVOID)Beb->FlashImage, (PVOID)Beb->FlashImage);

  000c4	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  000c7	8b 50 08	 mov	 edx, DWORD PTR [eax+8]
  000ca	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  000cd	8b 48 08	 mov	 ecx, DWORD PTR [eax+8]
  000d0	e8 00 00 00 00	 call	 ?BlFlashInitialize@@YIXPAX0@Z ; BlFlashInitialize

; 110  : 
; 111  :             break;

  000d5	eb 18		 jmp	 SHORT $LN11@BlInitiali
$LN5@BlInitiali:

; 112  :         }
; 113  : 
; 114  :         default: {
; 115  : 
; 116  :             BlRtlPrintf("unknown source!\n");

  000d7	68 00 00 00 00	 push	 OFFSET ??_C@_0BB@HJLOGHGL@unknown?5source?$CB?6?$AA@
  000dc	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  000e1	59		 pop	 ecx

; 117  : 
; 118  :             BlRtlHalt();

  000e2	6a 76		 push	 118			; 00000076H
  000e4	5a		 pop	 edx
  000e5	b9 00 00 00 00	 mov	 ecx, OFFSET ??_C@_0M@OKIOIALF@blentry?4cpp?$AA@
  000ea	e8 00 00 00 00	 call	 ?BlRtlHaltInternal@@YIXPBDK@Z ; BlRtlHaltInternal
$LN11@BlInitiali:

; 119  :         }
; 120  :     }
; 121  : 
; 122  :     //
; 123  :     // Initialize PNP BIOS support.
; 124  :     //
; 125  : 
; 126  :     if (Beb->BootType != BL_FLASH_BOOT) {

  000ef	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  000f2	83 38 05	 cmp	 DWORD PTR [eax], 5
  000f5	74 05		 je	 SHORT $LN4@BlInitiali

; 127  : 
; 128  :         BlPnpInitialize();

  000f7	e8 00 00 00 00	 call	 ?BlPnpInitialize@@YIXXZ	; BlPnpInitialize
$LN4@BlInitiali:

; 129  : 
; 130  :     }
; 131  : 
; 132  :     //
; 133  :     // Initialize MPS support.
; 134  :     //
; 135  : 
; 136  :     BlMpsInitialize();

  000fc	e8 00 00 00 00	 call	 ?BlMpsInitialize@@YIXXZ	; BlMpsInitialize

; 137  : 
; 138  :     //
; 139  :     // Initialize ACPI support.
; 140  :     //
; 141  : 
; 142  :     if (Beb->BootType != BL_FLASH_BOOT) {

  00101	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  00104	83 38 05	 cmp	 DWORD PTR [eax], 5
  00107	74 07		 je	 SHORT $LN3@BlInitiali

; 143  : 
; 144  :         BlAcpiInitialize();

  00109	e8 00 00 00 00	 call	 ?BlAcpiInitialize@@YIXXZ ; BlAcpiInitialize

; 145  : 
; 146  :     }
; 147  :     else {

  0010e	eb 0a		 jmp	 SHORT $LN2@BlInitiali
$LN3@BlInitiali:

; 148  : 
; 149  :         BlAcpiNumberOfProcessors = 1;

  00110	c7 05 00 00 00
	00 01 00 00 00	 mov	 DWORD PTR ?BlAcpiNumberOfProcessors@@3KA, 1 ; BlAcpiNumberOfProcessors
$LN2@BlInitiali:

; 150  : 
; 151  :     }
; 152  : 
; 153  :     //
; 154  :     // Set AP entry address.
; 155  :     //
; 156  : 
; 157  :     Beb->ApEntry = (UINT32) (ULONG_PTR) BlApEntry;

  0011a	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  0011d	c7 40 5c 00 00
	00 00		 mov	 DWORD PTR [eax+92], OFFSET ?BlApEntry@@YIXXZ ; BlApEntry

; 158  : 
; 159  :     //
; 160  :     // Initialize Singularity.
; 161  :     //
; 162  : 
; 163  :     if (BlCommandLine == NULL) {

  00124	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?BlCommandLine@@3PA_WA, 0 ; BlCommandLine
  0012b	75 0a		 jne	 SHORT $LN1@BlInitiali

; 164  : 
; 165  :         BlCommandLine = L"";

  0012d	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?BlCommandLine@@3PA_WA, OFFSET ??_C@_11LOCGONAA@?$AA?$AA@ ; BlCommandLine
$LN1@BlInitiali:

; 166  :     }
; 167  : 
; 168  :     BlSingularityInitialize(BlAcpiNumberOfProcessors,
; 169  :                             &Beb->ApEntry16,
; 170  :                             &Beb->ApStartupLock);

  00137	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  0013a	83 c0 60	 add	 eax, 96			; 00000060H
  0013d	50		 push	 eax
  0013e	8b 55 fc	 mov	 edx, DWORD PTR _Beb$[ebp]
  00141	83 c2 58	 add	 edx, 88			; 00000058H
  00144	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?BlAcpiNumberOfProcessors@@3KA ; BlAcpiNumberOfProcessors
  0014a	e8 00 00 00 00	 call	 ?BlSingularityInitialize@@YIXKPAU_FAR_POINTER@@0@Z ; BlSingularityInitialize

; 171  : }

  0014f	c9		 leave
  00150	c3		 ret	 0
?BlInitialize@@YIXXZ ENDP				; BlInitialize
; Function compile flags: /Odsp
; File c:\users\cc\source\repos\singularity-os\base\boot\singldrpc\bl.h
_TEXT	ENDS
;	COMDAT ?BlGetBeb@@YIPAU_BEB@@XZ
_TEXT	SEGMENT
?BlGetBeb@@YIPAU_BEB@@XZ PROC				; BlGetBeb, COMDAT

; 355  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 356  :     return ((PBEB) BEB_BASE);

  00003	b8 00 f0 02 00	 mov	 eax, 192512		; 0002f000H

; 357  : }

  00008	5d		 pop	 ebp
  00009	c3		 ret	 0
?BlGetBeb@@YIPAU_BEB@@XZ ENDP				; BlGetBeb
_TEXT	ENDS
PUBLIC	??_C@_0CK@OAMGPDO@Boot?5Time?3?5?$CF02u?1?$CF02u?1?$CF02u?5?$CF02u?3?$CF@ ; `string'
PUBLIC	??_C@_0BH@BBNKHCHK@Looking?5for?5debugger?4?6?$AA@ ; `string'
PUBLIC	??_C@_0CF@IHFGBGKJ@Singularity?5?$CFs?5Boot?5Loader?5?$FL?$CFs?5?$CF@ ; `string'
PUBLIC	??_C@_03NDFEINMN@x86?$AA@			; `string'
PUBLIC	??_C@_0M@JFIONPCF@Feb?523?52022?$AA@		; `string'
PUBLIC	??_C@_08DJHOGAJP@18?338?352?$AA@		; `string'
PUBLIC	?BlEntry@@YIXXZ					; BlEntry
EXTRN	?BlMmSwitchStack@@YIXPAX0@Z:PROC		; BlMmSwitchStack
EXTRN	?BlMmAllocatePhysicalRegion@@YI_KKK@Z:PROC	; BlMmAllocatePhysicalRegion
EXTRN	?BlKdInitialize@@YIXXZ:PROC			; BlKdInitialize
EXTRN	?BlPciInitialize@@YIXXZ:PROC			; BlPciInitialize
EXTRN	?BlMmInitializeSystem@@YIXXZ:PROC		; BlMmInitializeSystem
EXTRN	?BlRtlGetCurrentTime@@YIXPAU_BL_TIME@@@Z:PROC	; BlRtlGetCurrentTime
EXTRN	?BlVideoInitialize@@YIXXZ:PROC			; BlVideoInitialize
EXTRN	?BlTrapEnable@@YIXXZ:PROC			; BlTrapEnable
;	COMDAT ??_C@_0CK@OAMGPDO@Boot?5Time?3?5?$CF02u?1?$CF02u?1?$CF02u?5?$CF02u?3?$CF@
; File c:\users\cc\source\repos\singularity-os\base\boot\singldrpc\blentry.cpp
CONST	SEGMENT
??_C@_0CK@OAMGPDO@Boot?5Time?3?5?$CF02u?1?$CF02u?1?$CF02u?5?$CF02u?3?$CF@ DB 'B'
	DB	'oot Time: %02u/%02u/%02u %02u:%02u:%02u', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BH@BBNKHCHK@Looking?5for?5debugger?4?6?$AA@
CONST	SEGMENT
??_C@_0BH@BBNKHCHK@Looking?5for?5debugger?4?6?$AA@ DB 'Looking for debugg'
	DB	'er.', 0aH, 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0CF@IHFGBGKJ@Singularity?5?$CFs?5Boot?5Loader?5?$FL?$CFs?5?$CF@
CONST	SEGMENT
??_C@_0CF@IHFGBGKJ@Singularity?5?$CFs?5Boot?5Loader?5?$FL?$CFs?5?$CF@ DB 'S'
	DB	'ingularity %s Boot Loader [%s %s]', 0aH, 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_03NDFEINMN@x86?$AA@
CONST	SEGMENT
??_C@_03NDFEINMN@x86?$AA@ DB 'x86', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0M@JFIONPCF@Feb?523?52022?$AA@
CONST	SEGMENT
??_C@_0M@JFIONPCF@Feb?523?52022?$AA@ DB 'Feb 23 2022', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_08DJHOGAJP@18?338?352?$AA@
CONST	SEGMENT
??_C@_08DJHOGAJP@18?338?352?$AA@ DB '18:38:52', 00H	; `string'
; Function compile flags: /Odsp
CONST	ENDS
;	COMDAT ?BlEntry@@YIXXZ
_TEXT	SEGMENT
_Beb$ = -4						; size = 4
?BlEntry@@YIXXZ PROC					; BlEntry, COMDAT

; 198  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx

; 199  :     PBEB Beb;
; 200  : 
; 201  :     Beb = BlGetBeb();

  00004	e8 00 00 00 00	 call	 ?BlGetBeb@@YIPAU_BEB@@XZ ; BlGetBeb
  00009	89 45 fc	 mov	 DWORD PTR _Beb$[ebp], eax

; 202  : 
; 203  :     //
; 204  :     // Initialize the trap table.
; 205  :     //
; 206  :     BlTrapEnable();

  0000c	e8 00 00 00 00	 call	 ?BlTrapEnable@@YIXXZ	; BlTrapEnable

; 207  : 
; 208  :     //
; 209  :     // Initialize video.
; 210  :     //
; 211  : 
; 212  :     BlVideoInitialize();

  00011	e8 00 00 00 00	 call	 ?BlVideoInitialize@@YIXXZ ; BlVideoInitialize

; 213  : 
; 214  :     //
; 215  :     // Print the welcome banner.
; 216  :     //
; 217  : 
; 218  :     BlRtlPrintf("Singularity %s Boot Loader [%s %s]\n"
; 219  :                 "\n",
; 220  :                 PLATFORM_STRING,
; 221  :                 __DATE__,
; 222  :                 __TIME__);

  00016	68 00 00 00 00	 push	 OFFSET ??_C@_08DJHOGAJP@18?338?352?$AA@
  0001b	68 00 00 00 00	 push	 OFFSET ??_C@_0M@JFIONPCF@Feb?523?52022?$AA@
  00020	68 00 00 00 00	 push	 OFFSET ??_C@_03NDFEINMN@x86?$AA@
  00025	68 00 00 00 00	 push	 OFFSET ??_C@_0CF@IHFGBGKJ@Singularity?5?$CFs?5Boot?5Loader?5?$FL?$CFs?5?$CF@
  0002a	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  0002f	83 c4 10	 add	 esp, 16			; 00000010H

; 223  : 
; 224  :     //
; 225  :     // Capture boot start time.
; 226  :     //
; 227  : 
; 228  :     if (Beb->BootType != BL_FLASH_BOOT) {

  00032	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  00035	83 38 05	 cmp	 DWORD PTR [eax], 5
  00038	74 0a		 je	 SHORT $LN2@BlEntry

; 229  : 
; 230  :         BlRtlGetCurrentTime(&BlStartTime);

  0003a	b9 00 00 00 00	 mov	 ecx, OFFSET ?BlStartTime@@3U_BL_TIME@@A ; BlStartTime
  0003f	e8 00 00 00 00	 call	 ?BlRtlGetCurrentTime@@YIXPAU_BL_TIME@@@Z ; BlRtlGetCurrentTime
$LN2@BlEntry:

; 231  : 
; 232  :     }
; 233  : 
; 234  :     //
; 235  :     // Initialize memory management (ring transitions must follow this call).
; 236  :     //
; 237  : 
; 238  :     BlMmInitializeSystem();

  00044	e8 00 00 00 00	 call	 ?BlMmInitializeSystem@@YIXXZ ; BlMmInitializeSystem

; 239  : 
; 240  :     //
; 241  :     // Initialize PCI support (probe for 1394 interfaces for KD).
; 242  :     //
; 243  : 
; 244  :     if (Beb->BootType != BL_FLASH_BOOT) {

  00049	8b 45 fc	 mov	 eax, DWORD PTR _Beb$[ebp]
  0004c	83 38 05	 cmp	 DWORD PTR [eax], 5
  0004f	74 05		 je	 SHORT $LN1@BlEntry

; 245  : 
; 246  :         BlPciInitialize();

  00051	e8 00 00 00 00	 call	 ?BlPciInitialize@@YIXXZ	; BlPciInitialize
$LN1@BlEntry:

; 247  : 
; 248  :     }
; 249  : 
; 250  :     //
; 251  :     // Initialize KD.
; 252  :     //
; 253  : 
; 254  :     BlRtlPrintf("Looking for debugger.\n");

  00056	68 00 00 00 00	 push	 OFFSET ??_C@_0BH@BBNKHCHK@Looking?5for?5debugger?4?6?$AA@
  0005b	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  00060	59		 pop	 ecx

; 255  :     BlKdInitialize();

  00061	e8 00 00 00 00	 call	 ?BlKdInitialize@@YIXXZ	; BlKdInitialize

; 256  : 
; 257  :     //
; 258  :     // Print the welcome banner.
; 259  :     //
; 260  : 
; 261  :     BlRtlPrintf("Boot Time: %02u/%02u/%02u %02u:%02u:%02u\n",
; 262  :                 BlStartTime.Month,
; 263  :                 BlStartTime.Day,
; 264  :                 BlStartTime.Year,
; 265  :                 BlStartTime.Hour,
; 266  :                 BlStartTime.Minute,
; 267  :                 BlStartTime.Second);

  00066	0f b6 05 08 00
	00 00		 movzx	 eax, BYTE PTR ?BlStartTime@@3U_BL_TIME@@A+8
  0006d	50		 push	 eax
  0006e	0f b6 05 07 00
	00 00		 movzx	 eax, BYTE PTR ?BlStartTime@@3U_BL_TIME@@A+7
  00075	50		 push	 eax
  00076	0f b6 05 06 00
	00 00		 movzx	 eax, BYTE PTR ?BlStartTime@@3U_BL_TIME@@A+6
  0007d	50		 push	 eax
  0007e	ff 35 00 00 00
	00		 push	 DWORD PTR ?BlStartTime@@3U_BL_TIME@@A
  00084	0f b6 05 05 00
	00 00		 movzx	 eax, BYTE PTR ?BlStartTime@@3U_BL_TIME@@A+5
  0008b	50		 push	 eax
  0008c	0f b6 05 04 00
	00 00		 movzx	 eax, BYTE PTR ?BlStartTime@@3U_BL_TIME@@A+4
  00093	50		 push	 eax
  00094	68 00 00 00 00	 push	 OFFSET ??_C@_0CK@OAMGPDO@Boot?5Time?3?5?$CF02u?1?$CF02u?1?$CF02u?5?$CF02u?3?$CF@
  00099	e8 00 00 00 00	 call	 ?BlRtlPrintf@@YAEPBDZZ	; BlRtlPrintf
  0009e	83 c4 1c	 add	 esp, 28			; 0000001cH

; 268  : 
; 269  :     //
; 270  :     // Initialize VESA support.
; 271  :     //
; 272  : 
; 273  : #if VESA_ENABLED
; 274  : 
; 275  :     BlVesaInitialize();
; 276  : 
; 277  : #endif
; 278  : 
; 279  :     //
; 280  :     // Allocate and switch to the boot stack.
; 281  :     //
; 282  : 
; 283  :     BlBootStackLimit = (PVOID) (ULONG_PTR) BlMmAllocatePhysicalRegion(BL_BOOT_STACK_SIZE, BL_MM_PHYSICAL_REGION_BOOT_STACK);

  000a1	6a 0f		 push	 15			; 0000000fH
  000a3	5a		 pop	 edx
  000a4	b9 00 00 01 00	 mov	 ecx, 65536		; 00010000H
  000a9	e8 00 00 00 00	 call	 ?BlMmAllocatePhysicalRegion@@YI_KKK@Z ; BlMmAllocatePhysicalRegion
  000ae	a3 00 00 00 00	 mov	 DWORD PTR ?BlBootStackLimit@@3PAXA, eax ; BlBootStackLimit

; 284  :     BlBootStackBase = (PVOID) ((ULONG_PTR) BlBootStackLimit + BL_BOOT_STACK_SIZE);

  000b3	a1 00 00 00 00	 mov	 eax, DWORD PTR ?BlBootStackLimit@@3PAXA ; BlBootStackLimit
  000b8	05 00 00 01 00	 add	 eax, 65536		; 00010000H
  000bd	a3 00 00 00 00	 mov	 DWORD PTR ?BlBootStackBase@@3PAXA, eax ; BlBootStackBase

; 285  : 
; 286  :     BlMmSwitchStack(BlBootStackBase, BlInitialize);

  000c2	ba 00 00 00 00	 mov	 edx, OFFSET ?BlInitialize@@YIXXZ ; BlInitialize
  000c7	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?BlBootStackBase@@3PAXA ; BlBootStackBase
  000cd	e8 00 00 00 00	 call	 ?BlMmSwitchStack@@YIXPAX0@Z ; BlMmSwitchStack

; 287  : }

  000d2	c9		 leave
  000d3	c3		 ret	 0
?BlEntry@@YIXXZ ENDP					; BlEntry
_TEXT	ENDS
END
